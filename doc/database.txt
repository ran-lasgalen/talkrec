Структура базы данных
=====================

Модель данных с точки зрения подсистем записи и распознавания
-------------------------------------------------------------

Мы записываем и распознаем разговор сотрудника с клиентом в некотором
салоне. В исходных данных указывалось, что один и тот же сотрудник может
выходить на работу в разные салоны, поэтому "сотрудник разговаривал с клиентом
в салоне", а не "сотрудник работает в салоне". "Салон" - понятие условное,
минимальная организационная единица. Насколько мне удалось понять, интересует
аналитика по организационным единицам, у которых есть иерархия. На данный
момент отображение иерархии отсутствует, будет добавлено по мере формирования
аналитики.

Интерфейсу записи, расположенному в салоне, интересен список "своих"
сотрудников (предполагается, что их немного, и можно показать всех на одном
экране вместе с состоянием записи). Это отображено в структуре базы.

Система записи рассчитана на отсутствие постоянной связи с сервером
распознавания, но эпизодическая все же требуется. Система записи периодически
пытается обновить списки сотрудников с сервера, но если не может, работает с
тем, что есть.

Заведение нового сотрудника и/или указание, что он работает в этом салоне,
оставлено на администраторский интерфейс.

Записи, таблица talk
--------------------

id integer primary key - ключ, для ссылок
startedAt datetime - дата/время (начала) записи
talk text - распознанный текст записи
employeeId integer - ключ сотрудника
siteId integer - ключ салона

Сотрудники, таблица employee
----------------------------

id integer primary key - ключ для ссылок
name string - имя, для показа в интерфейсе

Поскольку в интерфейсе сотрудников можно различить только по именам, то
дополнительное требование, которое будет реализовано вне базы - полные тезки
возможны, но в каждом салоне все имена должны быть различны. Иногда для этого
может потребоваться поменять имя в базе (добавить какой-то признак для
различения).

Организационные единицы, таблица site
-------------------------------------

id integer primary key - идентификатор, для ссылок
name - название, для показа в аналитике

Распределение сотрудников по салонам, таблица site_employee
-----------------------------------------------------------

siteId - ключ салона
employeeId - ключ сотрудника

Применяется интерфейсом записи, чтобы отследить своих сотрудников. Сотрудник
может относиться к нескольким салонам.

Модель данных с точки зрения аналитики
--------------------------------------

У нас есть словарь регулярных выражений, которые мы ищем в записях
разговоров. При загрузке записи в базу данных мы анализируем ее на наличие
выражений из этого словаря, и храним соответствие.

При изменении словаря мы перепроверяем все записи на наличие добавленных
выражений. Для ускорения работы мы не допускаем с точки зрения базы изменение
регулярных выражений, чтобы не было необходимости перепроверять весь словарь
по всем записям. Вместо этого старое удаляется и добавляется новое (с тем же
описанием). С точки зрения человека это выглядит как редактирование.

Категории выражений, таблица phrase_category
--------------------------------------------

id integer primary key - идентификатор, для ссылок
title string unique - название

Словарь выражений, таблица phrases
----------------------------------

id integer primary key - идентификатор, для ссылок
categoryId integer - ключ категории
desired boolean not null - желательное/нежелательное
descr string unique - человекочитаемое описание выражения
regexp string - регулярное выражение

Вхождения выражений в записи, таблица phrase_in_talks
-----------------------------------------------------

phraseId - ключ выражения
talkId - ключ записи
n integer - количество вхождений
