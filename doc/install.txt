Установка сервера распознавания
===============================

Yandex SpeechKit Box
--------------------

Устанавливать по инструкции
<https://tech.yandex.ru/zout_speechkit/box/doc/guide_637d664254a1ebbd4c1a070bb28a9533/concepts/about-docpage/>. Сам не пробовал, было уже готовое. Нужно установить lingware
freeform. Остальные (более специализированные) не нужны.

Лицензия устаревает за 10 дней. Так что для постоянной работы нужно включить
скрипт обновления лицензии /etc/cron.daily/yandex_update_license. Из этого
следует, что у сервера должен быть нормальный (без хитрых авторизаций) доступ
к внешнему HTTPS. Скрипт при установке вроде бы прописывается в cron.daily, но
не работает, поскольку в Ubuntu и Debian оттуда выполняются только файлы без
расширения, а у него расширение .sh. Надо переименовать. В моем случае его
пришлось еще править, кажется, дописав ему ключ.

Для демонстрации постоянное обновление не требуется, но один раз ее обновить
(или получить) надо. Это можно сделать, запустив тот же скрипт вручную (от
рута). Скрипт пишет не на экран, а в /var/log/yandex/licenseupdate.log, отчет
о выполнении искать там.

Данные, которые оно запрашивает, нужны настоящие.

Подробности про лицензию:
<https://tech.yandex.ru/zout_speechkit/box/doc/guide_637d664254a1ebbd4c1a070bb28a9533/concepts/speechkit-box-get-license-docpage/>.

Симптомы неживой лицензии: yandex-asr-server при запуске долго тормозит, и в
начале лога ругается на лицензию. Тонкость: тормозит он тоже не молча, и если
смотреть systemctl status yandex-asr-server, то вскоре информация про лицензию
пролистнется. journalctl -xe позволяет увидеть больше.

Проверка установки:

    curl localhost:3457/info

должен выдавать информацию о lingware freeform. Это признак того, что успешно
запустился сам движок распознавания.

    curl localhost:80/ping

должен выдавать ничего, но завершаться успешно (не ругаться на ошибку). Это
признак того, что запустился прокси-сервер.

У меня при попытке запуска выяснилось, что библиотеки SSL, идущие в комплекте,
не тех версий. Дистрибутивные как раз тех, но нужные пакеты не стояли. Но судя
по тому, что я видел, он изначально ставился как-то криво. Симптомы:
собственно сервер (yandex-asr-server) запускается нормально, а прокси
(yandex-asr-proxy-server) — нет. Причем молчит как рыба об лед. Надо выкопать
из скрипта команду запуска бинарника и выполнить вручную, тогда он расскажет,
что не смог загрузить. Важно: скрипт запуска устанавливает переменную
окружения LD_LIBRARY_PATH так, чтобы библиотеки, идущие в комплекте, были
доступны, но, кажется, рассматривались последними. При ручном выяснении
проблем ее надо устанавливать, желательно аналогично. Тонкость такая:
собственные библиотеки из комплекта должны быть доступны, иначе не
запустится. Но одноименные дистрибутивным, похоже, должны быть позже
дистрибутивных, а то они кривые. Впрочем, кривизна, возможно, от кривой
установки до меня.

Остальное (прием записей и подача их в SpeechkitBox)
----------------------------------------------------

    $ sudo apt-get install --yes git screen
    $ screen
    $ cd
    $ git clone https://github.com/ran-lasgalen/talkrec.git
    $ cd talkrec
    $ install/server demo

В демонстрационном режиме, помимо процессов приема записей и передачи их на
распознавание, запускается еще простейший скрипт показа результатов
распознавания по мере их появления. Все они запускаются под screen,
последовательное переключение между ними по кругу производится
_последовательным_ нажатием Ctrl-A и пробела.

Процесс приема в норме не пишет ничего, у него пустой экран. Диспетчер
распознавания пишет о начале и об окончании распознавания. Процесс показа
результатов выводит очередной результат по мере его появления.

Установка системы записи разговоров
===================================

Для демо-установки достаточно знать IP сервера распознавания. Команды следует
выполнять из графического режима.

    $ sudo apt-get install --yes git screen
    $ screen
    $ cd
    $ git clone https://github.com/ran-lasgalen/talkrec.git
    $ cd talkrec
    $ install/client IP-адрес-сервера-распознавания

Запускаются под screen процессы собственно записи, передачи записей на сервер
распознавания, и процесс управления записью. Процесс управления записью —
графическая программа, ей и нужен графический режим.
